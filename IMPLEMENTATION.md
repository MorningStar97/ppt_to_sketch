# PPT to Sketch è½¬æ¢æœåŠ¡ - å®ç°åŸç†

ğŸ“‹ æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº† PPT to Sketch è½¬æ¢æœåŠ¡çš„æŠ€æœ¯æ¶æ„ã€æ ¸å¿ƒç®—æ³•å’Œå®ç°åŸç†ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ç•Œé¢       â”‚    â”‚   Djangoåç«¯     â”‚    â”‚   è½¬æ¢å¼•æ“       â”‚
â”‚                â”‚    â”‚                â”‚    â”‚                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚æ–‡ä»¶ä¸Šä¼ ç•Œé¢  â”‚ â”‚â—„â”€â”€â–ºâ”‚ â”‚REST API     â”‚ â”‚â—„â”€â”€â–ºâ”‚ â”‚PPTè§£æå™¨    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ä»»åŠ¡çŠ¶æ€ç›‘æ§  â”‚ â”‚â—„â”€â”€â–ºâ”‚ â”‚å¼‚æ­¥ä»»åŠ¡ç®¡ç†  â”‚ â”‚â—„â”€â”€â–ºâ”‚ â”‚åæ ‡è½¬æ¢å™¨    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚æ–‡ä»¶ä¸‹è½½     â”‚ â”‚â—„â”€â”€â–ºâ”‚ â”‚æ–‡ä»¶å­˜å‚¨ç®¡ç†  â”‚ â”‚â—„â”€â”€â–ºâ”‚ â”‚Sketchç”Ÿæˆå™¨  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆé€‰æ‹©

| å±‚çº§ | æŠ€æœ¯ | é€‰æ‹©åŸå›  |
|------|------|----------|
| **Webæ¡†æ¶** | Django 4.2 | æˆç†Ÿç¨³å®šã€ORMå¼ºå¤§ã€ç”Ÿæ€ä¸°å¯Œ |
| **APIæ¡†æ¶** | Django REST Framework | ä¸Djangoæ·±åº¦é›†æˆã€æ–‡æ¡£å®Œå–„ |
| **å‰ç«¯æ¡†æ¶** | Bootstrap 5 + Vanilla JS | è½»é‡çº§ã€å“åº”å¼ã€æ— å¤æ‚ä¾èµ– |
| **PPTè§£æ** | python-pptx | å®˜æ–¹æ¨èã€APIå®Œæ•´ã€æ–‡æ¡£è¯¦ç»† |
| **å›¾åƒå¤„ç†** | Pillow (PIL) | Pythonæ ‡å‡†å›¾åƒåº“ã€åŠŸèƒ½å…¨é¢ |
| **å¼‚æ­¥ä»»åŠ¡** | Threading | ç®€å•æœ‰æ•ˆã€å¯æ‰©å±•ä¸ºCelery |
| **æ•°æ®åº“** | SQLite/PostgreSQL | å¼€å‘ç®€å•ã€ç”Ÿäº§ç¨³å®š |

## ğŸ”„ è½¬æ¢æµç¨‹è¯¦è§£

### 1. æ–‡ä»¶ä¸Šä¼ ä¸éªŒè¯

```python
# converter/views.py
class ConversionTaskListCreateView(generics.ListCreateAPIView):
    def perform_create(self, serializer):
        # 1. æ–‡ä»¶æ ¼å¼éªŒè¯
        ppt_file = self.request.FILES['ppt_file']
        if not ppt_file.name.lower().endswith(('.ppt', '.pptx')):
            raise ValidationError("ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼")
        
        # 2. æ–‡ä»¶å¤§å°æ£€æŸ¥
        if ppt_file.size > settings.FILE_UPLOAD_MAX_MEMORY_SIZE:
            raise ValidationError("æ–‡ä»¶è¿‡å¤§")
        
        # 3. åˆ›å»ºè½¬æ¢ä»»åŠ¡
        task = serializer.save()
        
        # 4. å¯åŠ¨å¼‚æ­¥è½¬æ¢
        threading.Thread(
            target=convert_ppt_to_sketch_async,
            args=(task.id,),
            daemon=True
        ).start()
```

### 2. PPT ç»“æ„è§£æ

```python
# converter/utils.py
def convert_ppt_to_sketch(self, ppt_file_path, output_dir):
    # 1. åŠ è½½PPTæ–‡ä»¶
    presentation = Presentation(ppt_file_path)
    
    # 2. æå–ç”»æ¿å°ºå¯¸ï¼ˆç›´æ¥ä½¿ç”¨ç‚¹å•ä½ï¼‰
    self.artboard_width = presentation.slide_width.pt
    self.artboard_height = presentation.slide_height.pt
    
    # 3. é€é¡µè½¬æ¢å¹»ç¯ç‰‡
    artboards = []
    for i, slide in enumerate(presentation.slides):
        artboard = self.convert_slide_to_artboard(slide, i)
        if artboard:
            artboards.append(artboard)
```

### 3. å…ƒç´ åˆ†ç±»ä¸å¤„ç†

```python
def process_shape(self, shape, layer_name):
    """æ ¹æ®å½¢çŠ¶ç±»å‹åˆ†æ´¾åˆ°ä¸åŒçš„å¤„ç†æ–¹æ³•"""
    shape_type = shape.shape_type
    
    if shape_type == MSO_SHAPE_TYPE.GROUP:
        return self.create_group_layer(shape, layer_name)
    elif shape_type == MSO_SHAPE_TYPE.PICTURE:
        return self.create_image_layer(shape, layer_name)
    elif hasattr(shape, 'text_frame') and shape.text_frame.text.strip():
        return self.create_text_layer(shape, layer_name)
    else:
        return self.create_shape_layer(shape, layer_name)
```

## ğŸ¨ æ ¸å¿ƒè½¬æ¢ç®—æ³•

### åæ ‡ç³»ç»Ÿè½¬æ¢

PPT å’Œ Sketch ä½¿ç”¨ä¸åŒçš„åæ ‡ç³»ç»Ÿå’Œå•ä½ï¼Œéœ€è¦ç²¾ç¡®è½¬æ¢ï¼š

```python
# PPT ä½¿ç”¨ EMU (English Metric Units)
# 1 inch = 914,400 EMU
# 1 point = 12,700 EMU

# Sketch ä½¿ç”¨ Points
# 1 inch = 72 points

# è½¬æ¢ç­–ç•¥ï¼šç›´æ¥ä½¿ç”¨ python-pptx çš„ .pt å±æ€§
left = shape.left.pt   # è‡ªåŠ¨è½¬æ¢ä¸ºç‚¹
top = shape.top.pt     # è‡ªåŠ¨è½¬æ¢ä¸ºç‚¹
width = shape.width.pt # è‡ªåŠ¨è½¬æ¢ä¸ºç‚¹
height = shape.height.pt # è‡ªåŠ¨è½¬æ¢ä¸ºç‚¹
```

### é¢œè‰²è½¬æ¢ç®—æ³•

```python
def extract_color(self, color_obj):
    """å°†PPTé¢œè‰²è½¬æ¢ä¸ºSketchæ ¼å¼"""
    try:
        if isinstance(color_obj, RGBColor):
            # ç›´æ¥ä»RGBColorå¯¹è±¡æå–
            return {
                "_class": "color",
                "alpha": 1,
                "red": color_obj[0] / 255.0,    # 0-255 â†’ 0-1
                "green": color_obj[1] / 255.0,  # 0-255 â†’ 0-1
                "blue": color_obj[2] / 255.0    # 0-255 â†’ 0-1
            }
        elif hasattr(color_obj, 'rgb'):
            # ä»colorå¯¹è±¡çš„rgbå±æ€§æå–
            rgb = color_obj.rgb
            return {
                "_class": "color",
                "alpha": 1,
                "red": rgb[0] / 255.0,
                "green": rgb[1] / 255.0,
                "blue": rgb[2] / 255.0
            }
    except Exception as e:
        # é»˜è®¤è¿”å›é»‘è‰²
        return {"_class": "color", "alpha": 1, "red": 0, "green": 0, "blue": 0}
```

### æ—‹è½¬è§’åº¦è½¬æ¢

```python
# PPT: é¡ºæ—¶é’ˆä¸ºæ­£
# Sketch: é€†æ—¶é’ˆä¸ºæ­£
# è½¬æ¢å…¬å¼ï¼šsketch_rotation = -ppt_rotation

rotation = -shape.rotation if hasattr(shape, 'rotation') else 0
```

## ğŸ“ æ–‡æœ¬å¤„ç†ç®—æ³•

### æ™ºèƒ½å­—ä½“æ ·å¼æå–

```python
def create_text_layer(self, shape, layer_name):
    # ç»Ÿè®¡ä¸åŒå­—ä½“æ ·å¼çš„å­—ç¬¦æ•°é‡
    style_counts = {}
    for paragraph in text_frame.paragraphs:
        for run in paragraph.runs:
            if run.font.size and run.font.name:
                size = run.font.size.pt
                name = run.font.name
                color = self.extract_color(run.font.color.rgb)
                
                # ä½¿ç”¨å­—ç¬¦æ•°ä½œä¸ºæƒé‡
                style_key = (size, name, json.dumps(color))
                style_counts[style_key] = style_counts.get(style_key, 0) + len(run.text)
    
    # é€‰æ‹©åº”ç”¨èŒƒå›´æœ€å¹¿çš„æ ·å¼
    if style_counts:
        dominant_style = max(style_counts, key=style_counts.get)
        font_size, font_name, text_color = dominant_style
```

### æ®µè½å¯¹é½æ–¹å¼æ˜ å°„

```python
# PPTå¯¹é½æ–¹å¼åˆ°Sketchçš„æ˜ å°„
align_map = {
    PP_ALIGN.LEFT: 0,      # å·¦å¯¹é½
    PP_ALIGN.CENTER: 2,    # å±…ä¸­
    PP_ALIGN.RIGHT: 1,     # å³å¯¹é½
    PP_ALIGN.JUSTIFY: 3    # ä¸¤ç«¯å¯¹é½
}
alignment = align_map.get(paragraph.alignment, 0)
```

## ğŸ–¼ï¸ å›¾åƒå¤„ç†ç®—æ³•

### å›¾åƒä¼˜åŒ–ç­–ç•¥

```python
def optimize_image(self, image_blob, max_size=4096):
    """ä¼˜åŒ–å›¾ç‰‡ï¼šæ ¼å¼è½¬æ¢ + å°ºå¯¸å‹ç¼© + è´¨é‡æ§åˆ¶"""
    image = Image.open(io.BytesIO(image_blob))
    
    # 1. æ ¼å¼æ ‡å‡†åŒ–ï¼šç»Ÿä¸€è½¬ä¸ºRGB
    if image.mode == 'RGBA':
        # é€æ˜èƒŒæ™¯è½¬ä¸ºç™½è‰²èƒŒæ™¯
        background = Image.new('RGB', image.size, (255, 255, 255))
        background.paste(image, mask=image.split()[-1])
        image = background
    elif image.mode != 'RGB':
        image = image.convert('RGB')
    
    # 2. å°ºå¯¸ä¼˜åŒ–ï¼šå¤§å›¾ç‰‡ç¼©æ”¾
    if max(image.size) > max_size:
        image.thumbnail((max_size, max_size), Image.Resampling.LANCZOS)
    
    # 3. è´¨é‡æ§åˆ¶ï¼šé«˜è´¨é‡JPEGè¾“å‡º
    output = io.BytesIO()
    image.save(output, format='JPEG', quality=90, optimize=True)
    return output.getvalue()
```

### å›¾åƒæ•°æ®æ ¼å¼

```python
# ä½¿ç”¨ Buffer æ ¼å¼å­˜å‚¨å›¾åƒæ•°æ®ï¼Œå…¼å®¹Sketch
image_ref = f"images/{str(uuid.uuid4())}.png"
self.image_dict[image_ref] = {
    "type": "Buffer", 
    "data": list(image_data)  # å­—èŠ‚æ•°ç»„
}
```

## ğŸ—ï¸ ç»„åˆå›¾å±‚å¤„ç†

### é€’å½’å±‚çº§å¤„ç†

```python
def create_group_layer(self, shape, layer_name):
    """å¤„ç†PPTç»„åˆï¼Œä¿æŒå±‚çº§å…³ç³»"""
    group_left = shape.left.pt
    group_top = shape.top.pt
    
    sub_layers = []
    for i, sub_shape in enumerate(shape.shapes):
        sub_layer = self.process_shape(sub_shape, f"{layer_name}_child_{i}")
        if sub_layer:
            # å…³é”®ï¼šå­å›¾å±‚åæ ‡è½¬ä¸ºç›¸å¯¹äºçˆ¶ç»„çš„åæ ‡
            sub_layer['frame']['x'] -= group_left
            sub_layer['frame']['y'] -= group_top
            sub_layers.append(sub_layer)
    
    return {
        "_class": "group",
        "frame": {"x": group_left, "y": group_top, "width": width, "height": height},
        "layers": sub_layers
    }
```

## ğŸ“„ Sketch æ–‡ä»¶æ ¼å¼

### Sketch æ–‡ä»¶ç»“æ„

```
.sketch æ–‡ä»¶ (ZIPå‹ç¼©åŒ…)
â”œâ”€â”€ document.json          # ä¸»æ–‡æ¡£ä¿¡æ¯
â”œâ”€â”€ meta.json             # å…ƒæ•°æ®å’Œç‰ˆæœ¬ä¿¡æ¯  
â”œâ”€â”€ user.json             # ç”¨æˆ·è®¾ç½®ï¼ˆç¼©æ”¾ã€æ»šåŠ¨ä½ç½®ç­‰ï¼‰
â”œâ”€â”€ pages/                # é¡µé¢æ•°æ®ç›®å½•
â”‚   â””â”€â”€ {page-id}.json    # æ¯ä¸ªé¡µé¢çš„å›¾å±‚æ•°æ®
â”œâ”€â”€ workspace/            # å·¥ä½œç©ºé—´æ•°æ®ï¼ˆç¬¦å·ã€æ ·å¼ç­‰ï¼‰
â””â”€â”€ images/               # å›¾ç‰‡èµ„æº
    â”œâ”€â”€ {image-id}.png
    â””â”€â”€ {image-id}.jpg
```

### JSON ç»“æ„è®¾è®¡

```python
def _create_sketch_document(self, artboards):
    """åˆ›å»ºç¬¦åˆSketchæ ‡å‡†çš„JSONç»“æ„"""
    
    # 1. é¡µé¢æ•°æ®å’Œå¼•ç”¨åˆ†ç¦»
    pages_data = []
    page_refs = []
    
    for artboard in artboards:
        page_id = str(uuid.uuid4())
        
        # å®Œæ•´çš„é¡µé¢æ•°æ®
        page_data = {
            "_class": "page",
            "do_objectID": page_id,
            "name": artboard.get("name", "Page 1"),
            "layers": [artboard],  # artboardä½œä¸ºé¡µé¢çš„å­å›¾å±‚
            # ... å…¶ä»–æ ‡å‡†å±æ€§
        }
        pages_data.append(page_data)
        
        # æ–‡æ¡£ä¸­åªå­˜å‚¨å¼•ç”¨
        page_refs.append({
            "_class": "MSJSONFileReference",
            "_ref_class": "MSImmutablePage", 
            "_ref": f"pages/{page_id}"
        })
    
    # 2. ä¸»æ–‡æ¡£ç»“æ„
    document = {
        "_class": "document",
        "pages": page_refs,  # å¼•ç”¨è€Œéå®Œæ•´æ•°æ®
        "currentPageIndex": 0,
        # ... å…¶ä»–æ–‡æ¡£å±æ€§
    }
    
    return {
        "contents": {
            "document": document,
            "pages": pages_data,    # å®Œæ•´é¡µé¢æ•°æ®
            "meta": meta_data,      # å…ƒæ•°æ®
            "user": user_data,      # ç”¨æˆ·è®¾ç½®
            "workspace": {}         # å·¥ä½œç©ºé—´
        },
        "imageDic": self.image_dict  # å›¾ç‰‡æ•°æ®
    }
```

## ğŸ¨ Artboard è£å‰ªæœºåˆ¶

### æ ‡å‡†å±æ€§é…ç½®

```python
artboard = {
    "_class": "artboard",
    "hasClippingMask": True,        # å¯ç”¨è£å‰ª
    "clippingMaskMode": 0,          # é»˜è®¤è£å‰ªæ¨¡å¼
    "isVisible": True,              # ç¡®ä¿å¯è§
    "isLocked": False,              # å…è®¸ç¼–è¾‘
    # å®Œæ•´çš„å›¾å±‚å±æ€§
    "booleanOperation": -1,
    "resizingConstraint": 63,
    "style": {
        "_class": "style",
        "endMarkerType": 0,
        "miterLimit": 10,
        "windingRule": 1,
        "borders": [], "fills": [], "shadows": []
    },
    "exportOptions": {
        "_class": "exportOptions",
        "includedLayerIds": [],
        "layerOptions": 0,
        "shouldTrim": False,
        "exportFormats": []
    }
}
```

## ğŸ”„ å¼‚æ­¥ä»»åŠ¡ç®¡ç†

### ä»»åŠ¡çŠ¶æ€æµè½¬

```python
def convert_ppt_to_sketch_async(task_id):
    """å¼‚æ­¥è½¬æ¢ä»»åŠ¡"""
    task = ConversionTask.objects.get(id=task_id)
    
    try:
        # 1. æ›´æ–°çŠ¶æ€ä¸ºå¤„ç†ä¸­
        task.status = 'processing'
        task.save()
        
        # 2. æ‰§è¡Œè½¬æ¢
        converter = PPTToSketchConverter(verbose=True)
        sketch_file_path = converter.convert_ppt_to_sketch(
            task.ppt_file.path, 
            output_dir
        )
        
        # 3. ä¿å­˜ç»“æœæ–‡ä»¶
        with open(sketch_file_path, 'rb') as f:
            task.sketch_file.save(filename, File(f), save=True)
        
        # 4. æ›´æ–°çŠ¶æ€ä¸ºå®Œæˆ
        task.status = 'completed'
        task.error_message = None
        task.save()
        
    except Exception as e:
        # 5. é”™è¯¯å¤„ç†
        task.status = 'failed'
        task.error_message = str(e)
        task.save()
        logger.error(f"è½¬æ¢å¤±è´¥: {e}", exc_info=True)
```

## ğŸ¯ å…³é”®è®¾è®¡å†³ç­–

### 1. åæ ‡è½¬æ¢ç­–ç•¥

**é—®é¢˜**ï¼šPPTå’ŒSketchä½¿ç”¨ä¸åŒçš„å•ä½ç³»ç»Ÿ
- PPT: EMU (English Metric Units) 
- Sketch: Points

**è§£å†³æ–¹æ¡ˆ**ï¼šç›´æ¥ä½¿ç”¨ `python-pptx` çš„ `.pt` å±æ€§
```python
# é¿å…æ‰‹åŠ¨EMUè½¬æ¢ï¼Œå‡å°‘ç²¾åº¦æŸå¤±
left = shape.left.pt    # è€Œä¸æ˜¯ shape.left / 914400
```

**ä¼˜åŠ¿**ï¼š
- ç²¾åº¦æ›´é«˜
- ä»£ç æ›´ç®€æ´
- å‡å°‘è½¬æ¢é”™è¯¯

### 2. å›¾å±‚è£å‰ªæœºåˆ¶

**é—®é¢˜**ï¼šPPTä¸­çš„å…ƒç´ å¯èƒ½è¶…å‡ºå¹»ç¯ç‰‡è¾¹ç•Œ

**æ–¹æ¡ˆå¯¹æ¯”**ï¼š
- âŒ æ‰‹åŠ¨è®¡ç®—è£å‰ªï¼šå¤æ‚ä¸”å®¹æ˜“å‡ºé”™
- âœ… ä¾èµ–Sketchçš„ `hasClippingMask`ï¼šæ ‡å‡†ä¸”å¯é 

**å®ç°**ï¼š
```python
artboard = {
    "hasClippingMask": True,  # è®©Sketchå¤„ç†è£å‰ª
    "clippingMaskMode": 0,    # æ ‡å‡†è£å‰ªæ¨¡å¼
    # è¡¥å…¨æ‰€æœ‰æ ‡å‡†å±æ€§ç¡®ä¿è£å‰ªç”Ÿæ•ˆ
}
```

### 3. å›¾åƒå¤„ç†ç­–ç•¥

**ç›®æ ‡**ï¼šå¹³è¡¡æ–‡ä»¶å¤§å°å’Œå›¾åƒè´¨é‡

**ç­–ç•¥**ï¼š
- æ ¼å¼ç»Ÿä¸€ï¼šè½¬æ¢ä¸ºJPEGï¼ˆå‡å°ä½“ç§¯ï¼‰
- å°ºå¯¸é™åˆ¶ï¼šæœ€å¤§4096pxï¼ˆé€‚åˆå¤šæ•°åœºæ™¯ï¼‰
- è´¨é‡æ§åˆ¶ï¼š90%è´¨é‡ï¼ˆé«˜è´¨é‡ä¸”ä½“ç§¯åˆç†ï¼‰

### 4. å­—ä½“æ ·å¼æå–

**æŒ‘æˆ˜**ï¼šPPTæ–‡æœ¬å¯èƒ½åŒ…å«å¤šç§å­—ä½“æ ·å¼

**è§£å†³æ–¹æ¡ˆ**ï¼šåŸºäºå­—ç¬¦æ•°é‡çš„åŠ æƒé€‰æ‹©
```python
# ç»Ÿè®¡æ¯ç§æ ·å¼çš„å­—ç¬¦æ•°
style_counts[style_key] = style_counts.get(style_key, 0) + len(run.text)

# é€‰æ‹©è¦†ç›–å­—ç¬¦æœ€å¤šçš„æ ·å¼ä½œä¸ºä¸»æ ·å¼
dominant_style = max(style_counts, key=style_counts.get)
```

**ä¼˜åŠ¿**ï¼š
- è‡ªåŠ¨é€‰æ‹©ä¸»è¦æ ·å¼
- é¿å…æ ·å¼æ··ä¹±
- æé«˜è½¬æ¢è´¨é‡

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. å†…å­˜ç®¡ç†

```python
# å›¾åƒæµå¼å¤„ç†ï¼Œé¿å…å¤§é‡å†…å­˜å ç”¨
def optimize_image(self, image_blob, max_size=4096):
    with io.BytesIO(image_blob) as input_stream:
        image = Image.open(input_stream)
        # ... å¤„ç†
        with io.BytesIO() as output_stream:
            image.save(output_stream, format='JPEG')
            return output_stream.getvalue()
```

### 2. å¼‚æ­¥å¤„ç†

```python
# ä½¿ç”¨çº¿ç¨‹æ± é¿å…é˜»å¡ä¸»è¿›ç¨‹
conversion_thread = threading.Thread(
    target=convert_ppt_to_sketch_async,
    args=(task.id,),
    daemon=True  # ä¸»è¿›ç¨‹ç»“æŸæ—¶è‡ªåŠ¨æ¸…ç†
)
conversion_thread.start()
```

### 3. é”™è¯¯æ¢å¤

```python
# å¤šå±‚å¼‚å¸¸æ•è·ç¡®ä¿ç³»ç»Ÿç¨³å®š
try:
    # è½¬æ¢é€»è¾‘
except SpecificException as e:
    # ç‰¹å®šé”™è¯¯å¤„ç†
except Exception as e:
    # é€šç”¨é”™è¯¯å¤„ç†
    logger.error(f"æœªé¢„æœŸçš„é”™è¯¯: {e}", exc_info=True)
finally:
    # æ¸…ç†èµ„æº
    cleanup_temp_files()
```

## ğŸ” è°ƒè¯•ä¸ç›‘æ§

### æ—¥å¿—ç³»ç»Ÿ

```python
# åˆ†çº§æ—¥å¿—è®°å½•
def log(self, message, level='info'):
    if self.verbose:
        if level == 'error':
            logger.error(message)
        elif level == 'warning':
            logger.warning(message)
        else:
            logger.info(message)
```

### è¯¦ç»†é”™è¯¯ä¿¡æ¯

```python
# è®°å½•è½¬æ¢è¿‡ç¨‹ä¸­çš„å…³é”®ä¿¡æ¯
self.log(f"å¼€å§‹è½¬æ¢: {ppt_file_path}")
self.log(f"ç”»æ¿å°ºå¯¸: {self.artboard_width:.2f} x {self.artboard_height:.2f} ç‚¹")
self.log(f"è½¬æ¢ {len(artboards)} ä¸ªç”»æ¿")
self.log(f"Sketch æ–‡ä»¶ç”Ÿæˆå®Œæˆ: {sketch_file_path}")
```

## ğŸ”® æ‰©å±•èƒ½åŠ›

### 1. æ”¯æŒæ›´å¤šPPTå…ƒç´ 

```python
# å¯æ‰©å±•çš„å½¢çŠ¶å¤„ç†å™¨
shape_processors = {
    MSO_SHAPE_TYPE.GROUP: self.create_group_layer,
    MSO_SHAPE_TYPE.PICTURE: self.create_image_layer,
    MSO_SHAPE_TYPE.TEXT_BOX: self.create_text_layer,
    MSO_SHAPE_TYPE.AUTO_SHAPE: self.create_shape_layer,
    # å¯ç»§ç»­æ·»åŠ æ–°çš„å½¢çŠ¶ç±»å‹
}

processor = shape_processors.get(shape_type, self.create_shape_layer)
return processor(shape, layer_name)
```

### 2. è½¬æ¢è´¨é‡é…ç½®

```python
class ConversionConfig:
    """è½¬æ¢é…ç½®ç±»"""
    MAX_IMAGE_SIZE = 4096
    IMAGE_QUALITY = 90
    ENABLE_IMAGE_OPTIMIZATION = True
    VERBOSE_LOGGING = False
    
    # å¯é€šè¿‡ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶åŠ¨æ€è°ƒæ•´
```

### 3. è¾“å‡ºæ ¼å¼æ‰©å±•

```python
# å¯æ‰©å±•åˆ°å…¶ä»–è®¾è®¡å·¥å…·æ ¼å¼
class ConverterFactory:
    converters = {
        'sketch': PPTToSketchConverter,
        'figma': PPTToFigmaConverter,    # æœªæ¥æ”¯æŒ
        'adobe_xd': PPTToXDConverter,    # æœªæ¥æ”¯æŒ
    }
    
    @classmethod
    def get_converter(cls, format_type):
        return cls.converters.get(format_type, PPTToSketchConverter)
```

## ğŸ“š æ€»ç»“

æœ¬é¡¹ç›®å®ç°äº†ä»PPTåˆ°Sketchçš„é«˜è´¨é‡è½¬æ¢ï¼Œå…³é”®æŠ€æœ¯è¦ç‚¹åŒ…æ‹¬ï¼š

1. **ç²¾ç¡®çš„åæ ‡ç³»ç»Ÿè½¬æ¢**ï¼šé¿å…æ‰‹åŠ¨è®¡ç®—ï¼Œä½¿ç”¨åº“æä¾›çš„æ ‡å‡†è½¬æ¢
2. **æ™ºèƒ½çš„æ ·å¼æå–ç®—æ³•**ï¼šåŸºäºå­—ç¬¦æ•°é‡åŠ æƒé€‰æ‹©ä¸»è¦æ ·å¼
3. **æ ‡å‡†çš„Sketchæ–‡ä»¶æ ¼å¼**ï¼šä¸¥æ ¼éµå¾ªSketchçš„JSONç»“æ„è§„èŒƒ
4. **å¯é çš„å›¾å±‚è£å‰ªæœºåˆ¶**ï¼šä½¿ç”¨SketchåŸç”Ÿçš„è£å‰ªåŠŸèƒ½
5. **é«˜æ•ˆçš„å¼‚æ­¥å¤„ç†**ï¼šä¸é˜»å¡ç”¨æˆ·æ“ä½œï¼Œæä¾›å®æ—¶çŠ¶æ€åé¦ˆ
6. **å®Œå–„çš„é”™è¯¯å¤„ç†**ï¼šå¤šå±‚å¼‚å¸¸æ•è·ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§

é€šè¿‡è¿™äº›æŠ€æœ¯æ–¹æ¡ˆï¼Œé¡¹ç›®å®ç°äº†é«˜ä¿çœŸåº¦çš„PPTåˆ°Sketchè½¬æ¢ï¼Œä¸ºè®¾è®¡å¸ˆæä¾›äº†ä¾¿æ·çš„å·¥å…·é“¾ã€‚ 